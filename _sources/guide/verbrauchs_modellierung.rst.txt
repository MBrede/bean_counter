.. _verbrauchs_modellierung:

Dokumentation der Verbrauchsmodellierung
==========================================

In diesem Bereich wird die Inbetriebnahme der Verbrauchsmodellierung demonstriert. Die Verbrauchsmodellierung befindet sich im Ordner "<Pfad des Projektordners>/Verbrauchs_Modellierung". Die Skripte, welche in Rahmen der Verbrauchmodellierung genutzt werden finden sich direkt in diesem Ordner währenddessen die verwendeten Datensätze sich im Unterordner data finden lassen.


Starten des Skriptes
--------------------
Zum Ausführen des Skriptes wird gegebenenfalls die virtuelle Python Umgebung benötigt. Die Einrichtung dieser wird :ref:`hier <Einrichtung der virtuellen Python Umgebung>` weiter erläutert.

Zum Starten des Skriptes muss der Ordner der Verbrauchmodellierung geöffnet werden:

.. code-block:: bash

   cd <Pfad des Projektes>/Verbrauchs_Modellierung

Danach kann das Skript folgendermaßen ausgeführt werden:

.. code-block:: bash

   python estimate.py


Daraufhin fragt das Skript den Session-Cookie für den Zugriff auf den Datensatz an:

.. image:: ../_static/img/cookie_abfrage.png
   :width: 700
   :alt: Cookie Anfrage


Um den aktuellen Session-Cookie zu erhalten wird der Datensatz mit allen Netzanschlüssen ausgewählt:

.. image:: ../_static/img/datensatz_auswahl.png
   :width: 700
   :alt: Datensatz Auswahl

Im Browser öffnet sich online das zugehörige Excel-Sheet.

Durch drücken von ``Ctrl`` + ``Shift`` + ``I`` (Linux) oder ``F12`` (Windows) öffnen sich die Entwicklertools.

Dort lässt sich der Web-Traffic durch Auswählen des Reiters "Network" analysieren:

.. image:: ../_static/img/network_tools.png
   :width: 700
   :alt: Network Tools

Es empfielt sich den Namen des Datensatzes (in diesem Fall: 20210525_station_atkis_analyse_all_last_modified) als Suchfilter einzustellen:

.. image:: ../_static/img/search_filter.png
   :width: 700
   :alt: Such Filter

Danach wird nach der Korrespondenz mit der größten Speichergröße gesucht und per Klick ausgewählt:

.. image:: ../_static/img/biggest_request.png
   :width: 700
   :alt: biggest request


Es öffnet sich ein Fenster unter dem der Reiter "Headers" ausgewählt und anschließend zu dem "Request Header" gescrollt werden muss, dort befindet sich der Session-Cookie:

.. image:: ../_static/img/cookie.png
   :width: 700
   :alt: cookie

Durch rechter Mausklick und Auswahl von "Copy Value" lässt sich der Cookie-Inhalt kopieren.

Durch Einfügen in der Konsole und Bestätigung mit ``Enter`` wird das Skript ausgeführt:

.. image:: ../_static/img/skript_started.png
   :width: 700
   :alt: skript started

Als Alternative kann der Cookie einfach als JSON im Auswertungsordner abgelegt und im request referenziert werden:

.. image:: ../_static/img/cookie_json.png
   :width: 700
   :alt: skript started
